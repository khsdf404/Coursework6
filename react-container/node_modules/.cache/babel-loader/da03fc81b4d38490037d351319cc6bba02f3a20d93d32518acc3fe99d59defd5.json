{"ast":null,"code":"import { LocalStorage } from './LocalStorage';\nconst WEB_URL = 'http://localhost:3000';\nconst API_URL = 'http://localhost:8080';\nclass AuthDB {\n  static async Registry(user) {\n    console.log(`${API_URL}/auth/reg/`);\n    return await AuthDB.Request(`${API_URL}/auth/reg/`, 'POST', user);\n  }\n  static async Login(user) {\n    return await AuthDB.Request(`${API_URL}/auth/login/`, 'POST', user);\n  }\n  static async GetUserInfo() {\n    return await AuthDB.Request(`${API_URL}/auth/users/`, 'GET', null, LocalStorage.GetToken());\n  }\n  static async UpdateUserInfo(user) {\n    return await AuthDB.Request(`${API_URL}/auth/users/`, 'POST', user, LocalStorage.GetToken());\n  }\n  static async Redirect() {\n    function changeWindowLocation(location) {\n      let currentLocation = window.location.href.replace(WEB_URL, '');\n      if (currentLocation !== location) {\n        window.location.replace(location);\n      }\n    }\n    await AuthDB.Request(`${API_URL}/auth/token/`, 'GET', null, LocalStorage.GetToken()).then(responseData => {\n      if (responseData === null || responseData['token'] === null) {\n        LocalStorage.SetToken('');\n        if (window.location.href !== `${WEB_URL}/`) window.location.replace('/');\n        return;\n      }\n      LocalStorage.SetToken(responseData['token']);\n      if (responseData['role'] === 'ROLE_USER') changeWindowLocation('/polls/');\n    });\n  }\n  static async Request(url, method = 'GET', bodyObj = null, token = null) {\n    let result = null;\n    let obj = {};\n    obj['method'] = method;\n    obj['headers'] = {};\n    obj['headers']['Content-type'] = 'application/json';\n    if (token) obj['headers']['Authorization'] = `Bearer ${token}`;\n    if (bodyObj) obj['body'] = JSON.stringify(bodyObj);\n    await fetch(url, obj).then(async response => {\n      console.log(response);\n      if (response.ok) await response.json().then(data => {\n        console.log(data);\n        result = data;\n      });else response.text().then(console.log);\n    });\n    return result;\n  }\n}\nexport { AuthDB };","map":{"version":3,"names":["LocalStorage","WEB_URL","API_URL","AuthDB","Registry","user","console","log","Request","Login","GetUserInfo","GetToken","UpdateUserInfo","Redirect","changeWindowLocation","location","currentLocation","window","href","replace","then","responseData","SetToken","url","method","bodyObj","token","result","obj","JSON","stringify","fetch","response","ok","json","data","text"],"sources":["/home/khsdf/tmp/K3/src/hooks/AuthDB.js"],"sourcesContent":["import { LocalStorage }  from './LocalStorage';\r\n\r\nconst WEB_URL = 'http://localhost:3000'\r\nconst API_URL = 'http://localhost:8080';\r\n\r\nclass AuthDB {\r\n\r\n    static async Registry(user) {\r\n        console.log(`${API_URL}/auth/reg/`);\r\n        return await AuthDB.Request(`${API_URL}/auth/reg/`, 'POST', user);\r\n    }\r\n\r\n    static async Login(user) {\r\n        return await AuthDB.Request(`${API_URL}/auth/login/`, 'POST', user);\r\n    }\r\n\r\n    static async GetUserInfo() {\r\n        return await AuthDB.Request(`${API_URL}/auth/users/`, 'GET', null, LocalStorage.GetToken());\r\n    }\r\n\r\n    static async UpdateUserInfo(user) {\r\n        return await AuthDB.Request(`${API_URL}/auth/users/`, 'POST', user, LocalStorage.GetToken());\r\n    }\r\n\r\n    static async Redirect() {\r\n\r\n        function changeWindowLocation(location) {\r\n            let currentLocation = window.location.href.replace(WEB_URL, '');\r\n            if (currentLocation !== location) {\r\n                window.location.replace(location)\r\n            }\r\n        }\r\n\r\n        await AuthDB.Request(`${API_URL}/auth/token/`, 'GET', null, LocalStorage.GetToken()).then(responseData => {\r\n            if (responseData === null || responseData['token'] === null) {\r\n                LocalStorage.SetToken('');\r\n                if (window.location.href !== `${WEB_URL}/`)\r\n                    window.location.replace('/');\r\n                return;\r\n            }\r\n\r\n            LocalStorage.SetToken(responseData['token']);\r\n    \r\n            if (responseData['role'] === 'ROLE_USER')\r\n                changeWindowLocation('/polls/')\r\n        });\r\n        \r\n    }\r\n    \r\n\r\n    static async Request(url, method = 'GET', bodyObj = null, token = null) {\r\n        \r\n        let result = null;\r\n        let obj = {};\r\n\r\n        obj['method'] = method;\r\n        \r\n        obj['headers'] = {};\r\n        obj['headers']['Content-type'] = 'application/json';\r\n\r\n        if (token) obj['headers']['Authorization'] = `Bearer ${token}`;\r\n            \r\n        if (bodyObj) obj['body'] = JSON.stringify(bodyObj);\r\n        \r\n        await fetch(url, obj).then(async (response) => {\r\n            console.log(response)\r\n            if (response.ok)\r\n                await response.json().then(data => {\r\n                    console.log(data);\r\n                    result = data;\r\n                })\r\n            else \r\n                response.text().then(console.log)\r\n        });\r\n\r\n        return result;\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { AuthDB }"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}